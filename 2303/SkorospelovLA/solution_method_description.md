## Описание метода решения
### Общий обзор метода решения
В конечном решении нужно создать легкомасштабируемый надёжный веб-сервис со следующими функциональными частями:
* Регистрация и авторизация пользователя;
* Поиск музыки, похожей на конкретную композицию, выбранную пользователем;
* Расширенный поиск музыки, в параметрах которого пользователь может задать перечисленные ниже, но не ограничиваясь лишь этим списком, параметры:
  1. Жанр (поп, рок, академическая музыка и т.д.);
  2. Тональность (до мажор, фа-диез мажор, соль минор и т.д.) [1], а также связанные с ней характеристики, описанные в [2];
  3. Темп музыки (40-48, 44-52, 63-80 и т.д.) [3];
  4. Тип лада (модальная гармония, тональная гармония);
  5. Тип музыкального стиля (например, "гармония барокко" [4];
  6. Главная нота (аккорд);
  7. Наличие вокала.
* Аналогичные варианты поиска для отдельных частей музыкальных композиций;
* Возможность загружать собственные композиции;
* Ограничивать поиск похожей музыки среди загруженной своей библиотеки музыки.
Исследования показывают, что значения времени загрузки страницы сервиса более 1 секунды значительно уменьшают конверсию на сайтах [5] [6], однако на домашней конфигурации компьютера (Intel B950, 2.1 GHz) рассчёт одного лишь темпа с помощью библотеки Librosa [7] композиции длиной 5 минут занимает более 20 секунд, что является не приемлемым. В связи с этим, требуется организовать очередь рассчёта параметров композиции для отложенного получения результатов.
### Особенности метода решения
Таким образом, стек технологий должен прелагать лёгкую масштабируемость в случае увеличения нагрузки, а также простоту в использовании и реализации. Плюсом является направленность на технологии с открытым исходным кодом по внутренним убеждениям авторов. Согласно рекомендации сообщества DigitalOcean [8] был сделан выбор в пользу следующего стека технологий: Python, Django, Librosa, PostgreSQL, Gunicorn (+Nginx). Неподсредственное взаимодействие между компонентами этого стека также описаны в [9].
Общая архитектура системы (см. рисунок 1) условно разделяет процесс обработки аудио на 4 этапа:
1. Пользователь загружает аудио-файл на сервер (PreLoadedAudio), который делится на равные временные промежутки, которые помещаются в очередь на обработку;
2. Из задач в очереди формируются запросы на обработку (ProcessQuery) для отдельных потоков обработки (Processor), который контроллируется менеджером потоков обработки (ThreadManager);
3. Информация об обработанных аудио-файлах и информация о полученных характеристиках сохраняется в базу данных;
4. При поисковом запросе пользователем происходит выборка из базы данных по заданным пользоватем параметрам.

![Рис. 1 - Общая архитектура решения. Пример с BPM (темп).](https://pp.userapi.com/c840622/v840622299/33a51/yZvIzKfzg2c.jpg)

Рис. 1 - Общая архитектура решения. Пример с BPM (темп).

## Источники
1. И. Дубовский, С. Евсеев, И. Способин, В. Соколов. Учебник гармонии. М.: Музыка, 2007
2. Тональность - Википедия. 16.12.2017, URL: https://ru.wikipedia.org/wiki/Тональность
3. Мальтер Л. Таблицы по инструментоведению. — М., 1964.
4. Музыка эпохи барокко — Википедия. 16.12.2017, URL: https://ru.wikipedia.org/wiki/Музыка_эпохи_барокко
5. Marissa Mayer. In Search of... A better, faster, stronger Web. - Velocity. Web performance and operations conference. 22-24 June 2009
6. Why Web Performance Matters: Is Your Site Driving Customers Away? 2010, URL: http://www.mcrinc.com/Documents/Newsletters/201110_why_web_performance_matters.pdf
7. Librosa. 16.12.2017, URL: https://librosa.github.io/
8. Popular tutorials | Digital Ocean. 16.12.2017, URL: https://www.digitalocean.com/community/tutorials?q=django&primary_filter=popular
9. How To Set Up Django with Postgres, Nginx, and Gunicorn on Ubuntu 16.04 | DigitalOcean. 16.12.2017, URL: https://www.digitalocean.com/community/tutorials/how-to-set-up-django-with-postgres-nginx-and-gunicorn-on-ubuntu-16-04
